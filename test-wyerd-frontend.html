<!DOCTYPE html>
<html>
<head>
    <title>wyerd.net Frontend Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>wyerd.net Frontend URL Test</h1>
    <button onclick="testDetermineWorkingUrl()">Test Frontend Logic</button>
    <div id="results"></div>
    
    <script>
        // Simulate the frontend checkDomainStatus function
        async function checkDomainStatus(domain) {
            try {
                const response = await fetch('/api/opensrs/check-domain-status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ domain, timestamp: Date.now() })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const backendUrl = result.url || result.recommended_url || result.workingUrl;
                    
                    return {
                        status: result.status,
                        url: backendUrl,
                        message: result.message,
                        accessible: result.accessible
                    };
                }
            } catch (error) {
                console.error('Error checking domain status:', error);
            }
            return null;
        }
        
        // Simulate the frontend determineWorkingUrl function
        async function determineWorkingUrl(customUrl, domain) {
            console.log(`üîç determineWorkingUrl called for domain: ${domain}, customUrl: ${customUrl}`);
            
            if (!domain) {
                console.log('üåê No domain provided, using custom URL');
                return customUrl || '';
            }

            // SPECIAL CASE: wyerd.net is known to not be fully configured, force GitHub Pages
            if (domain === 'wyerd.net') {
                const githubUrl = 'https://Martinionline.github.io/wyerd-net-website';
                console.log(`üîß HARD OVERRIDE: wyerd.net MUST use GitHub Pages: ${githubUrl}`);
                return githubUrl;
            }

            try {
                const domainStatus = await checkDomainStatus(domain);
                console.log(`üéØ Domain status for ${domain}:`, domainStatus);
                
                if (domainStatus && domainStatus.url) {
                    console.log(`‚úÖ USING backend URL for ${domain}: ${domainStatus.url}`);
                    return domainStatus.url;
                } else {
                    console.log(`üöÄ No URL from backend for ${domain}, using fallback`);
                    return customUrl || '';
                }
            } catch (error) {
                console.error(`‚ùå Error checking domain status for ${domain}:`, error);
                return customUrl || '';
            }
        }
        
        async function testDetermineWorkingUrl() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="result">Testing wyerd.net frontend logic...</div>';
            
            try {
                console.log('üß™ Testing wyerd.net frontend logic...');
                
                // Test the hard override
                const result1 = await determineWorkingUrl(null, 'wyerd.net');
                const result2 = await determineWorkingUrl('https://wyerd.net', 'wyerd.net');
                
                const isCorrect = result1.includes('github.io') && result2.includes('github.io');
                
                results.innerHTML = `
                    <div class="result ${isCorrect ? 'success' : 'error'}">
                        <h3>Frontend Logic Test Results</h3>
                        <p><strong>Test 1 - determineWorkingUrl(null, 'wyerd.net'):</strong><br>
                        <code>${result1}</code></p>
                        
                        <p><strong>Test 2 - determineWorkingUrl('https://wyerd.net', 'wyerd.net'):</strong><br>
                        <code>${result2}</code></p>
                        
                        <h4>Result:</h4>
                        ${isCorrect 
                            ? '<p style="color: green;">‚úÖ CORRECT: Both tests return GitHub Pages URL</p>'
                            : '<p style="color: red;">‚ùå WRONG: Frontend logic is not working correctly</p>'
                        }
                        
                        <p><strong>Expected:</strong> Both should return <code>https://Martinionline.github.io/wyerd-net-website</code></p>
                        
                        <h4>View Site Button Should Link To:</h4>
                        <p><a href="${result1}" target="_blank" style="background: #007bff; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px;">Test GitHub Pages Link</a></p>
                    </div>
                `;
                
            } catch (error) {
                console.error('‚ùå Test Error:', error);
                results.innerHTML = `<div class="result error">‚ùå Test Error: ${error.message}</div>`;
            }
        }
        
        // Auto-run test on page load
        window.onload = () => testDetermineWorkingUrl();
    </script>
</body>
</html>